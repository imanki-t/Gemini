<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lumin Intelligence Control</title>
    
    <!-- Fonts: Merriweather (Serif) & Inter (Sans) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <!-- UI Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], serif: ['Merriweather', 'serif'] },
                    colors: {
                        ink: { 950: '#0d0d0c', 900: '#171716', 850: '#1c1c1b', 800: '#232321', 700: '#2e2e2c', 400: '#8c8c88', 100: '#e8e8e3' },
                        sand: { 500: '#d4a373', 600: '#c59260', 900: '#4a3b2a' },
                        danger: { 500: '#ef4444', 900: '#451a1a' },
                        success: { 500: '#22c55e', 900: '#143820' }
                    },
                    animation: { 'fade-in': 'fadeIn 0.4s ease-out' },
                    keyframes: { fadeIn: { '0%': { opacity: 0, transform: 'translateY(10px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } } }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0d0d0c; color: #e8e8e3; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0d0d0c; }
        ::-webkit-scrollbar-thumb { background: #2e2e2c; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b4b49; }
        .glass-panel { background: #171716; border: 1px solid #2e2e2c; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .cmd-btn:active { transform: scale(0.98); }
        .nav-item.active { background: #232321; color: #d4a373; border-left: 3px solid #d4a373; }
        .terminal-line { font-family: 'JetBrains Mono', monospace; line-height: 1.5; }
    </style>
</head>
<body class="font-sans antialiased h-screen flex overflow-hidden selection:bg-sand-500 selection:text-ink-900">

    <!-- DESKTOP SIDEBAR -->
    <aside class="hidden lg:flex flex-col w-72 bg-ink-900 border-r border-ink-700 h-full z-20">
        <div class="h-20 flex items-center px-6 border-b border-ink-700">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-sand-500 to-sand-600 flex items-center justify-center mr-3 shadow-lg shadow-sand-500/10">
                <i class="ph-bold ph-sparkle text-ink-900 text-xl"></i>
            </div>
            <div>
                <h1 class="font-serif font-bold text-xl text-ink-100 tracking-tight">Lumin</h1>
                <p class="text-[10px] uppercase tracking-widest text-ink-400 font-semibold mt-0.5">Control Center</p>
            </div>
        </div>

        <nav class="flex-1 py-6 px-4 space-y-1">
            <div class="px-2 mb-2 text-[10px] font-bold text-ink-400 uppercase tracking-wider">Dashboard</div>
            <button onclick="nav('overview')" id="nav-overview" class="nav-item active w-full flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-all text-ink-400 hover:text-ink-100 hover:bg-ink-800"><i class="ph ph-squares-four text-lg mr-3"></i> Overview</button>
            <button onclick="nav('commands')" id="nav-commands" class="nav-item w-full flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-all text-ink-400 hover:text-ink-100 hover:bg-ink-800"><i class="ph ph-command text-lg mr-3"></i> Commands (50+)</button>
            
            <div class="px-2 mt-6 mb-2 text-[10px] font-bold text-ink-400 uppercase tracking-wider">Management</div>
            <button onclick="nav('servers')" id="nav-servers" class="nav-item w-full flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-all text-ink-400 hover:text-ink-100 hover:bg-ink-800"><i class="ph ph-buildings text-lg mr-3"></i> Server List</button>
            <button onclick="nav('users')" id="nav-users" class="nav-item w-full flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-all text-ink-400 hover:text-ink-100 hover:bg-ink-800"><i class="ph ph-users text-lg mr-3"></i> User Base</button>
            
            <div class="px-2 mt-6 mb-2 text-[10px] font-bold text-ink-400 uppercase tracking-wider">System</div>
            <button onclick="nav('ai')" id="nav-ai" class="nav-item w-full flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-all text-ink-400 hover:text-ink-100 hover:bg-ink-800"><i class="ph ph-brain text-lg mr-3"></i> AI Config</button>
            <button onclick="nav('logs')" id="nav-logs" class="nav-item w-full flex items-center px-3 py-3 text-sm font-medium rounded-lg transition-all text-ink-400 hover:text-ink-100 hover:bg-ink-800"><i class="ph ph-terminal-window text-lg mr-3"></i> Live Terminal</button>
        </nav>

        <div class="p-4 border-t border-ink-700 bg-ink-850">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-ink-700 border border-ink-600 flex items-center justify-center"><i class="ph-bold ph-user"></i></div>
                <div class="flex-1">
                    <p class="text-xs font-bold text-ink-100">Administrator</p>
                    <p class="text-[10px] text-green-400 flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Connected</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT AREA -->
    <main class="flex-1 flex flex-col h-full overflow-hidden bg-ink-950 relative w-full">
        <!-- HEADER -->
        <header class="h-16 flex items-center justify-between px-6 border-b border-ink-800 bg-ink-950/90 backdrop-blur z-30 sticky top-0">
            <div class="lg:hidden flex items-center gap-3">
                <div class="w-8 h-8 rounded bg-sand-500 flex items-center justify-center text-ink-900"><i class="ph-bold ph-sparkle"></i></div>
                <span class="font-serif font-bold text-ink-100">Lumin</span>
            </div>
            
            <!-- Connection Status -->
            <div class="hidden lg:flex items-center gap-6">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.4)]"></span>
                    <span class="text-xs font-mono text-ink-400">WS: <span id="ping-display" class="text-ink-100">--ms</span></span>
                </div>
                <div class="h-4 w-px bg-ink-800"></div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-sand-500"></span>
                    <span class="text-xs font-mono text-ink-400">DB: <span class="text-ink-100">Connected</span></span>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <div id="maintenance-badge" class="hidden px-3 py-1 bg-red-900/20 border border-red-900/50 rounded-full flex items-center gap-2">
                    <i class="ph-fill ph-warning-octagon text-red-500 text-xs"></i>
                    <span class="text-[10px] font-bold text-red-400 uppercase tracking-wide">Maintenance Mode</span>
                </div>
                <button onclick="refreshData()" class="p-2 text-ink-400 hover:text-ink-100 transition-colors rounded-lg hover:bg-ink-800"><i id="refresh-icon" class="ph-bold ph-arrows-clockwise text-lg"></i></button>
            </div>
        </header>

        <!-- SCROLLABLE CONTENT -->
        <div class="flex-1 overflow-y-auto p-4 lg:p-8 space-y-8" id="main-scroll">
            
            <!-- VIEW: OVERVIEW -->
            <div id="view-overview" class="view-section space-y-6 animate-fade-in">
                <!-- KPI Grid -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="glass-panel p-5 rounded-xl border-l-4 border-l-sand-500 relative overflow-hidden">
                        <div class="absolute right-0 top-0 p-3 opacity-5"><i class="ph-fill ph-chat-circle-dots text-5xl"></i></div>
                        <p class="text-[10px] font-bold text-ink-400 uppercase tracking-widest">Total Traffic</p>
                        <h3 class="text-3xl font-serif font-bold text-ink-100 mt-2" id="stat-reqs">0</h3>
                        <p class="text-xs text-green-500 mt-1 flex items-center"><i class="ph-bold ph-trend-up mr-1"></i> Live</p>
                    </div>
                    <div class="glass-panel p-5 rounded-xl border-l-4 border-l-blue-500 relative overflow-hidden">
                        <div class="absolute right-0 top-0 p-3 opacity-5"><i class="ph-fill ph-users-three text-5xl"></i></div>
                        <p class="text-[10px] font-bold text-ink-400 uppercase tracking-widest">Total Users</p>
                        <h3 class="text-3xl font-serif font-bold text-ink-100 mt-2" id="stat-users">0</h3>
                        <p class="text-xs text-ink-400 mt-1">Across <span id="stat-guilds">0</span> servers</p>
                    </div>
                    <div class="glass-panel p-5 rounded-xl border-l-4 border-l-purple-500 relative overflow-hidden">
                        <div class="absolute right-0 top-0 p-3 opacity-5"><i class="ph-fill ph-cpu text-5xl"></i></div>
                        <p class="text-[10px] font-bold text-ink-400 uppercase tracking-widest">System Uptime</p>
                        <h3 class="text-xl font-serif font-bold text-ink-100 mt-3 font-mono" id="stat-uptime">00:00:00</h3>
                    </div>
                    <div class="glass-panel p-5 rounded-xl border-l-4 border-l-red-500 relative overflow-hidden">
                        <div class="absolute right-0 top-0 p-3 opacity-5"><i class="ph-fill ph-warning text-5xl"></i></div>
                        <p class="text-[10px] font-bold text-ink-400 uppercase tracking-widest">Error Rate</p>
                        <h3 class="text-3xl font-serif font-bold text-ink-100 mt-2" id="stat-errors">0</h3>
                        <p class="text-xs text-ink-400 mt-1">Last 24 hours</p>
                    </div>
                </div>

                <!-- Charts & Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 glass-panel p-6 rounded-xl">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-serif font-bold text-ink-100 text-lg">Request Volume</h3>
                            <div class="flex gap-2">
                                <span class="w-3 h-3 rounded-full bg-sand-500"></span>
                                <span class="text-xs text-ink-400">Gemini API Calls</span>
                            </div>
                        </div>
                        <div id="mainChart" style="min-height: 300px;"></div>
                    </div>
                    
                    <div class="glass-panel p-6 rounded-xl flex flex-col">
                        <h3 class="font-serif font-bold text-ink-100 text-lg mb-4">Gemini API Keys</h3>
                        <div class="flex-1 space-y-4" id="api-key-list">
                            <!-- Injected Keys -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: COMMAND CENTER (50 COMMANDS) -->
            <div id="view-commands" class="view-section hidden space-y-6 animate-fade-in">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div>
                        <h2 class="font-serif font-bold text-2xl text-ink-100">Command Center</h2>
                        <p class="text-xs text-ink-400">Execute administrative actions directly on the bot instance.</p>
                    </div>
                    <input type="text" id="cmd-search" placeholder="Search 50+ commands..." class="w-full md:w-64 bg-ink-900 border border-ink-700 rounded-lg px-4 py-2 text-sm text-ink-100 focus:border-sand-500 outline-none">
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3" id="cmd-grid">
                    <!-- Commands injected via JS -->
                </div>
            </div>

            <!-- VIEW: SERVERS -->
            <div id="view-servers" class="view-section hidden space-y-6 animate-fade-in">
                <div class="glass-panel p-6 rounded-xl overflow-hidden">
                    <h2 class="font-serif font-bold text-xl text-ink-100 mb-6">Connected Guilds</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-ink-900 text-xs uppercase font-bold text-ink-400">
                                <tr>
                                    <th class="p-4 rounded-tl-lg">Server Name</th>
                                    <th class="p-4">ID</th>
                                    <th class="p-4">Members</th>
                                    <th class="p-4 rounded-tr-lg text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="server-table-body" class="text-sm text-ink-100 divide-y divide-ink-800"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: AI CONFIG -->
            <div id="view-ai" class="view-section hidden space-y-6 animate-fade-in">
                <div class="glass-panel p-8 rounded-xl max-w-4xl mx-auto">
                    <h2 class="font-serif font-bold text-2xl text-ink-100 mb-2">Artificial Intelligence Configuration</h2>
                    <p class="text-sm text-ink-400 mb-8 border-b border-ink-800 pb-6">Modify the underlying behavior of the Gemini integration.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                        <div>
                            <label class="block text-xs font-bold text-ink-400 uppercase mb-3">Model Architecture</label>
                            <div class="space-y-3">
                                <label class="flex items-center p-4 border border-sand-500 bg-sand-900/10 rounded-xl cursor-pointer">
                                    <input type="radio" name="model" value="flash" checked class="text-sand-500 focus:ring-sand-500 bg-ink-900 border-ink-700">
                                    <div class="ml-4">
                                        <span class="block text-sm font-bold text-ink-100">Gemini 1.5 Flash</span>
                                        <span class="block text-xs text-ink-400">Low latency, high throughput.</span>
                                    </div>
                                </label>
                                <label class="flex items-center p-4 border border-ink-700 bg-ink-900 rounded-xl cursor-pointer hover:border-ink-600">
                                    <input type="radio" name="model" value="pro" class="text-sand-500 focus:ring-sand-500 bg-ink-900 border-ink-700">
                                    <div class="ml-4">
                                        <span class="block text-sm font-bold text-ink-100">Gemini 1.5 Pro</span>
                                        <span class="block text-xs text-ink-400">Complex reasoning tasks.</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-ink-400 uppercase mb-3">Temperature (Creativity)</label>
                            <div class="flex items-center gap-4 mb-2">
                                <span class="text-xs text-ink-400">Precise</span>
                                <input type="range" min="0" max="1" step="0.1" value="0.7" class="w-full h-2 bg-ink-800 rounded-lg appearance-none cursor-pointer accent-sand-500">
                                <span class="text-xs text-ink-400">Creative</span>
                            </div>
                            <p class="text-xs text-ink-400 mt-2">Current Value: <span class="text-ink-100 font-mono">0.7</span></p>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-ink-400 uppercase mb-3">System Prompt Override</label>
                        <textarea id="sys-prompt" class="w-full h-48 bg-ink-900 border border-ink-700 rounded-xl p-4 text-sm text-ink-100 focus:border-sand-500 outline-none font-mono leading-relaxed resize-none" placeholder="You are Lumin..."></textarea>
                        <div class="flex justify-end mt-4">
                            <button onclick="saveAiConfig()" class="px-6 py-2 bg-sand-600 hover:bg-sand-500 text-ink-900 font-bold rounded-lg text-sm transition shadow-lg shadow-sand-600/20">Apply Changes</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: LIVE TERMINAL -->
            <div id="view-logs" class="view-section hidden h-[calc(100vh-140px)] animate-fade-in">
                <div class="glass-panel h-full rounded-xl flex flex-col overflow-hidden border-ink-800">
                    <div class="bg-ink-900 p-3 border-b border-ink-800 flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <i class="ph-bold ph-terminal-window text-ink-400"></i>
                            <span class="text-xs font-mono font-bold text-ink-100">root@lumin-bot:~# logs -f</span>
                        </div>
                        <div class="flex gap-1.5">
                            <span class="w-2.5 h-2.5 rounded-full bg-ink-700"></span>
                            <span class="w-2.5 h-2.5 rounded-full bg-ink-700"></span>
                        </div>
                    </div>
                    <div id="terminal-output" class="flex-1 bg-ink-950 p-4 font-mono text-xs overflow-y-auto space-y-1">
                        <!-- Logs stream here -->
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- MOBILE NAV -->
    <nav class="lg:hidden fixed bottom-0 w-full bg-ink-900 border-t border-ink-800 flex justify-around py-3 z-50 safe-area-pb">
        <button onclick="nav('overview')" class="flex flex-col items-center text-ink-400 hover:text-sand-500"><i class="ph ph-squares-four text-2xl"></i><span class="text-[9px] font-bold mt-1">Home</span></button>
        <button onclick="nav('commands')" class="flex flex-col items-center text-ink-400 hover:text-sand-500"><i class="ph ph-command text-2xl"></i><span class="text-[9px] font-bold mt-1">Cmds</span></button>
        <button onclick="nav('servers')" class="flex flex-col items-center text-ink-400 hover:text-sand-500"><i class="ph ph-buildings text-2xl"></i><span class="text-[9px] font-bold mt-1">Servers</span></button>
        <button onclick="nav('logs')" class="flex flex-col items-center text-ink-400 hover:text-sand-500"><i class="ph ph-terminal-window text-2xl"></i><span class="text-[9px] font-bold mt-1">Logs</span></button>
    </nav>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed top-6 right-6 z-[60] bg-ink-800 border border-ink-700 text-ink-100 px-5 py-4 rounded-xl shadow-2xl flex items-center gap-4 transform translate-x-full opacity-0 transition-all duration-300">
        <div id="toast-icon" class="text-xl"></div>
        <div>
            <h4 id="toast-title" class="text-sm font-bold">Notification</h4>
            <p id="toast-msg" class="text-xs text-ink-400">Details here...</p>
        </div>
    </div>

    <script>
        // --- 50 COMMANDS DEFINITION ---
        const commands = [
            // SYSTEM (10)
            { id: 'shutdown', name: 'Force Shutdown', cat: 'danger', icon: 'power' },
            { id: 'restart', name: 'Restart System', cat: 'danger', icon: 'arrows-clockwise' },
            { id: 'maintenance_on', name: 'Maintenance ON', cat: 'danger', icon: 'lock-key' },
            { id: 'maintenance_off', name: 'Maintenance OFF', cat: 'success', icon: 'lock-key-open' },
            { id: 'reload_cfg', name: 'Reload Config', cat: 'system', icon: 'file-code' },
            { id: 'dump_heap', name: 'Dump Heap', cat: 'debug', icon: 'memory' },
            { id: 'gc', name: 'Garbage Collect', cat: 'debug', icon: 'trash' },
            { id: 'uptime', name: 'Check Uptime', cat: 'system', icon: 'clock' },
            { id: 'version', name: 'Version Info', cat: 'system', icon: 'info' },
            { id: 'update', name: 'Pull Updates', cat: 'system', icon: 'download-simple' },
            // DISCORD (10)
            { id: 'leave_guild', name: 'Leave Guild', cat: 'danger', icon: 'sign-out' },
            { id: 'sync_cmds', name: 'Sync Slash Cmds', cat: 'discord', icon: 'arrows-merge' },
            { id: 'set_status', name: 'Set Presence', cat: 'discord', icon: 'tag' },
            { id: 'set_avatar', name: 'Set Avatar', cat: 'discord', icon: 'image' },
            { id: 'create_invite', name: 'Create Invite', cat: 'discord', icon: 'link' },
            { id: 'prune_members', name: 'Prune Inactive', cat: 'mod', icon: 'users-three' },
            { id: 'list_roles', name: 'List Roles', cat: 'discord', icon: 'list-dashes' },
            { id: 'guild_info', name: 'Guild Info', cat: 'discord', icon: 'info' },
            { id: 'dm_owner', name: 'DM Owner', cat: 'mod', icon: 'paper-plane-tilt' },
            { id: 'clear_dms', name: 'Clear DM Queue', cat: 'discord', icon: 'broom' },
            // USERS (10)
            { id: 'blacklist', name: 'Blacklist User', cat: 'mod', icon: 'prohibit' },
            { id: 'unblacklist', name: 'Unblacklist', cat: 'success', icon: 'check-circle' },
            { id: 'reset_limit', name: 'Reset Rate Limit', cat: 'mod', icon: 'clock-counter-clockwise' },
            { id: 'user_info', name: 'Get User Info', cat: 'mod', icon: 'user-focus' },
            { id: 'warn_user', name: 'Warn User', cat: 'mod', icon: 'warning' },
            { id: 'ban_user', name: 'Ban User', cat: 'danger', icon: 'gavel' },
            { id: 'kick_user', name: 'Kick User', cat: 'danger', icon: 'boot' },
            { id: 'timeout', name: 'Timeout User', cat: 'mod', icon: 'timer' },
            { id: 'dm_user', name: 'DM User', cat: 'mod', icon: 'chat-circle-text' },
            { id: 'gift_prem', name: 'Gift Premium', cat: 'success', icon: 'star' },
            // AI (10)
            { id: 'set_prompt', name: 'Set Prompt', cat: 'ai', icon: 'text-t' },
            { id: 'clear_ctx', name: 'Clear Context', cat: 'ai', icon: 'eraser' },
            { id: 'switch_model', name: 'Switch Model', cat: 'ai', icon: 'cpu' },
            { id: 'set_temp', name: 'Set Temp', cat: 'ai', icon: 'thermometer' },
            { id: 'test_prompt', name: 'Test Generation', cat: 'ai', icon: 'flask' },
            { id: 'reset_tokens', name: 'Reset Tokens', cat: 'ai', icon: 'coin' },
            { id: 'view_quota', name: 'View Quota', cat: 'ai', icon: 'chart-pie' },
            { id: 'rotate_key', name: 'Rotate Key', cat: 'ai', icon: 'key' },
            { id: 'block_word', name: 'Block Keyword', cat: 'mod', icon: 'x' },
            { id: 'whitelist', name: 'Whitelist User', cat: 'success', icon: 'check' },
            // DATA (10)
            { id: 'backup_db', name: 'Backup DB', cat: 'data', icon: 'floppy-disk' },
            { id: 'restore_db', name: 'Restore DB', cat: 'danger', icon: 'arrow-counter-clockwise' },
            { id: 'clear_cache', name: 'Clear Cache', cat: 'data', icon: 'trash' },
            { id: 'cache_size', name: 'Cache Size', cat: 'data', icon: 'database' },
            { id: 'export_logs', name: 'Export Logs', cat: 'data', icon: 'file-text' },
            { id: 'del_logs', name: 'Delete Logs', cat: 'danger', icon: 'fire' },
            { id: 'error_rate', name: 'View Errors', cat: 'data', icon: 'warning-octagon' },
            { id: 'test_db', name: 'Test Conn', cat: 'debug', icon: 'plugs' },
            { id: 'seed_data', name: 'Seed Data', cat: 'debug', icon: 'plant' },
            { id: 'reindex', name: 'Re-index DB', cat: 'data', icon: 'list-numbers' }
        ];

        // --- APP LOGIC ---

        function initCommands() {
            const grid = document.getElementById('cmd-grid');
            grid.innerHTML = commands.map(c => {
                let colorClass = 'text-ink-400 group-hover:text-ink-100 bg-ink-800';
                if(c.cat === 'danger') colorClass = 'text-red-400 group-hover:text-red-100 bg-red-900/10 border-red-900/30';
                if(c.cat === 'success') colorClass = 'text-green-400 group-hover:text-green-100 bg-green-900/10 border-green-900/30';
                
                return `
                <button onclick="execCmd('${c.id}')" class="cmd-btn group flex items-center gap-3 p-3 rounded-lg border border-ink-800 hover:border-ink-600 transition-all text-left glass-panel">
                    <div class="w-8 h-8 rounded-md flex items-center justify-center ${colorClass}">
                        <i class="ph-bold ph-${c.icon}"></i>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-ink-100">${c.name}</p>
                        <p class="text-[9px] text-ink-400 uppercase tracking-wide mt-0.5">${c.cat}</p>
                    </div>
                </button>`;
            }).join('');

            // Search Filter
            document.getElementById('cmd-search').addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                document.querySelectorAll('.cmd-btn').forEach(btn => {
                    btn.style.display = btn.innerText.toLowerCase().includes(term) ? 'flex' : 'none';
                });
            });
        }

        async function execCmd(id) {
            showToast('Processing...', 'info');
            try {
                const res = await fetch('/api/action', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ type: id })
                });
                const data = await res.json();
                if(data.success) showToast(`${id} executed successfully`, 'success');
                else showToast(`Error: ${data.message}`, 'error');
                refreshData();
            } catch(e) { showToast('Network Error', 'error'); }
        }

        async function refreshData() {
            document.getElementById('refresh-icon').classList.add('animate-spin');
            try {
                const res = await fetch('/api/stats');
                const data = await res.json();
                
                // Stats
                document.getElementById('stat-reqs').innerText = data.stats.reqs.toLocaleString();
                document.getElementById('stat-users').innerText = data.stats.users.toLocaleString();
                document.getElementById('stat-guilds').innerText = data.stats.guilds;
                document.getElementById('stat-errors').innerText = data.stats.errors;
                document.getElementById('stat-uptime').innerText = formatUptime(data.stats.uptime);
                document.getElementById('ping-display').innerText = data.stats.ping + 'ms';
                
                // Maintenance
                const badge = document.getElementById('maintenance-badge');
                if(data.config.maintenance) badge.classList.remove('hidden');
                else badge.classList.add('hidden');

                // Keys
                const keyList = document.getElementById('api-key-list');
                keyList.innerHTML = data.keys.map((k, i) => `
                    <div class="flex justify-between items-center text-xs p-2 rounded bg-ink-900 border border-ink-800">
                        <span class="font-mono text-ink-400">Key-${i+1} (${k.status})</span>
                        <span class="text-ink-100 font-bold">${k.usage}%</span>
                    </div>
                    <div class="w-full bg-ink-800 h-1 rounded-full overflow-hidden mt-1">
                        <div class="bg-sand-500 h-full" style="width: ${k.usage}%"></div>
                    </div>
                `).join('');

                // Logs
                const term = document.getElementById('terminal-output');
                term.innerHTML = data.logs.map(l => 
                    `<div class="terminal-line"><span class="text-ink-600">[${l.time}]</span> <span class="${l.type === 'err' ? 'text-red-400' : 'text-green-400'}">${l.msg}</span></div>`
                ).join('');
                term.scrollTop = term.scrollHeight;

            } catch(e) { console.error(e); }
            setTimeout(() => document.getElementById('refresh-icon').classList.remove('animate-spin'), 500);
        }

        async function fetchServers() {
            const res = await fetch('/api/servers');
            const data = await res.json();
            const tbody = document.getElementById('server-table-body');
            tbody.innerHTML = data.map(s => `
                <tr class="hover:bg-ink-900 transition-colors">
                    <td class="p-4 font-bold text-ink-100">${s.name}</td>
                    <td class="p-4 font-mono text-ink-400">${s.id}</td>
                    <td class="p-4 text-ink-400">${s.members}</td>
                    <td class="p-4 text-right">
                        <button onclick="execCmd('leave_guild')" class="px-3 py-1 bg-red-900/20 text-red-400 text-xs rounded hover:bg-red-900/40">Force Leave</button>
                    </td>
                </tr>
            `).join('');
        }

        async function saveAiConfig() {
            const prompt = document.getElementById('sys-prompt').value;
            await fetch('/api/config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ systemPrompt: prompt })
            });
            showToast('AI Persona Updated', 'success');
        }

        // --- UTILS ---
        function nav(id) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${id}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active', 'bg-ink-800', 'text-ink-100'));
            const btn = document.getElementById(`nav-${id}`);
            if(btn) btn.classList.add('active', 'bg-ink-800', 'text-ink-100');
            if(id === 'servers') fetchServers();
        }

        function showToast(msg, type) {
            const t = document.getElementById('toast');
            const i = document.getElementById('toast-icon');
            const tit = document.getElementById('toast-title');
            document.getElementById('toast-msg').innerText = msg;
            
            t.classList.remove('translate-x-full', 'opacity-0');
            if(type === 'success') { i.innerHTML = '<i class="ph-fill ph-check-circle text-green-500"></i>'; tit.innerText = 'Success'; }
            else if(type === 'error') { i.innerHTML = '<i class="ph-fill ph-x-circle text-red-500"></i>'; tit.innerText = 'Error'; }
            else { i.innerHTML = '<i class="ph-fill ph-info text-blue-500"></i>'; tit.innerText = 'Info'; }
            
            setTimeout(() => t.classList.add('translate-x-full', 'opacity-0'), 3000);
        }

        function formatUptime(s) {
            const d = Math.floor(s / (3600*24));
            const h = Math.floor(s % (3600*24) / 3600);
            const m = Math.floor(s % 3600 / 60);
            return `${d}d ${h}h ${m}m`;
        }

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            initCommands();
            refreshData();
            setInterval(refreshData, 2000);

            // Chart
            new ApexCharts(document.querySelector("#mainChart"), {
                series: [{ name: 'Requests', data: [30,40,35,50,49,60,70,91,125] }],
                chart: { height: 300, type: 'area', toolbar: {show:false}, background: 'transparent', fontFamily: 'Inter' },
                colors: ['#d4a373'], fill: { type: 'gradient', gradient: { opacityFrom: 0.4, opacityTo: 0 } },
                stroke: { curve: 'smooth', width: 2 },
                xaxis: { labels: {show:false}, axisBorder: {show:false}, axisTicks: {show:false} },
                yaxis: { labels: {style: {colors: '#8c8c88'}} },
                grid: { borderColor: '#2e2e2c' }, theme: { mode: 'dark' }
            }).render();
        });
    </script>
</body>
</html>
